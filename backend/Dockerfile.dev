FROM node:18

WORKDIR /app

COPY package*.json ./
RUN npm install
RUN npm install -g wait-on

COPY prisma ./prisma
RUN npx prisma generate

COPY . .

# Expose API port
EXPOSE 3000

# Create a startup script
COPY <<EOF /app/start.sh
#!/bin/bash
echo "Waiting for database to be ready..."
wait-on tcp:dev-db:5432 -t 60000

echo "Starting NestJS in development mode..."
npm run start:dev
EOF

RUN chmod +x /app/start.sh

# The start script will be run when the container starts
CMD ["/app/start.sh"] 